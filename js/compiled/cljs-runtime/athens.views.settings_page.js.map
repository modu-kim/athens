{"version":3,"sources":["athens/views/settings_page.cljs"],"mappings":"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","names":["athens.views.settings-page/opt-out","opted-out?","js/posthog","js/window","js/localStorage.setItem","cljs.core/reset!","athens.views.settings-page/opt-in","athens.views.settings-page/handle-click","cljs.core/deref","athens.views.settings-page/handle-debounce-save-input","value","debounce-time","athens.electron/debounce-write-db","goog.functions/debounce","athens.electron/write-db","athens.views.settings-page/handle-change-email","email","athens.views.settings-page/a","cljs.core.atom","athens.views.settings-page/handle-click-email","authed?","sending-request","api","email-qs","query-url","c__50417__auto__","cljs.core.async.chan","cljs.core.async.impl.dispatch/run","f__50418__auto__","switch__50381__auto__","state_64190","state_val_64191","inst_64165","cljs.core.async.impl.ioc-helpers/take!","inst_64168","inst_64167","statearr-64192","statearr-64193","statearr-64194","inst_64170","inst_64171","statearr-64195","statearr-64196","inst_64174","statearr-64197","statearr-64198","inst_64176","inst_64177","inst_64178","inst_64179","statearr-64199","statearr-64200","inst_64181","inst_64182","inst_64183","inst_64184","inst_64185","statearr-64201","statearr-64202","inst_64187","inst_64188","statearr-64203","cljs.core.async.impl.ioc-helpers/return-chan","statearr-64204","state-machine__50382__auto__","ret-value__50383__auto__","result__50384__auto__","cljs.core/keyword-identical?","ex__50385__auto__","e64205","statearr-64206","cljs.core/seq","statearr-64207","cljs.core/first","state__50419__auto__","statearr-64208","cljs.core.async.impl.ioc-helpers/USER-START-IDX","cljs.core.async.impl.ioc-helpers/run-state-machine-wrapped","cljs-http.client/get","js/alert","athens.views.settings-page/init-email","js/localStorage.getItem","cljs.core._EQ_","athens.views.settings-page/settings-page","reagent.core.atom","debounce-save-time!","js/Number","p1__64209#","p1__64210#","submit-disabled","or__4126__auto__","athens.views.buttons/button","cljs.core/not","js/module$node_modules$$material_ui$icons$index.ToggleOn","js/module$node_modules$$material_ui$icons$index.ToggleOff","G__64211"],"sourcesContent":["(ns athens.views.settings-page\n  (:require\n    [\"@material-ui/icons\" :as mui-icons]\n    [athens.electron :as electron]\n    [athens.views.buttons :refer [button]]\n    [cljs-http.client :as http]\n    [cljs.core.async :refer [<!]]\n    [goog.functions :as goog-functions]\n    [reagent.core :as r])\n  (:require-macros\n    [cljs.core.async.macros :refer [go]]))\n\n\n(defn opt-out\n  [opted-out?]\n  (.. js/posthog (capture \"opt-out\"))\n  (.. js/window -posthog opt_out_capturing)\n  (js/localStorage.setItem \"sentry\" \"off\")\n  (reset! opted-out? true))\n\n\n(defn opt-in\n  [opted-out?]\n  (.. js/window -posthog opt_in_capturing)\n  (.. js/posthog (capture \"opt-in\"))\n  (js/localStorage.setItem \"sentry\" \"on\")\n  (reset! opted-out? false))\n\n\n(defn handle-click\n  [opted-out?]\n  (if @opted-out?\n    (opt-in opted-out?)\n    (opt-out opted-out?)))\n\n\n(defn handle-debounce-save-input\n  [value debounce-time]\n  (when (and (<= 0 value) (<= value 1000))\n    (reset! debounce-time value)\n    (set! electron/debounce-write-db (goog-functions/debounce electron/write-db (* 1000 value)))\n    (js/localStorage.setItem \"debounce-save-time\" value)))\n\n\n(defn handle-change-email\n  [email value]\n  (reset! email value))\n\n\n(def a (atom nil))\n\n\n(defn handle-click-email\n  [email authed? sending-request]\n  (let [api       \"https://dhx9n94ty5.execute-api.us-east-1.amazonaws.com/Prod/hello\"\n        email-qs  \"?email=\"\n        query-url (str api email-qs email)]\n    (reset! sending-request true)\n    (go (let [resp (<! (http/get query-url))]\n          (if (and (:success resp) (:email_exists (:body resp)))\n            (do\n              (js/localStorage.setItem \"auth/email\" email)\n              (js/localStorage.setItem \"auth/authed?\" (str true))\n              (reset! authed? true))\n            (do\n              (js/localStorage.setItem \"auth/email\" nil)\n              (js/localStorage.setItem \"auth/authed?\" (str false))\n              (reset! authed? false)\n              (js/alert \"No OpenCollective account was found with this email address.\")))\n          (reset! sending-request false)))))\n\n\n(defn init-email\n  []\n  (let [email (js/localStorage.getItem \"auth/email\")]\n    (if (= email \"null\")\n      \"\"\n      email)))\n\n\n(defn settings-page\n  []\n  (let [opted-out?          (r/atom (.. js/window -posthog has_opted_out_capturing))\n        ;; pretty easy to get around this auth. Lol\n        authed?             (r/atom (= (js/localStorage.getItem \"auth/authed?\") \"true\"))\n        email               (r/atom (init-email))\n        sending-request     (r/atom false)\n        debounce-save-time! (r/atom (js/Number (js/localStorage.getItem \"debounce-save-time\")))]\n\n    (fn []\n      (let [submit-disabled     (or @sending-request @authed?)]\n\n        [:div {:style {:display        \"flex\"\n                       :margin         \"0vh 5vw\"\n                       :width          \"90vw\"\n                       :flex-direction \"column\"}}\n         [:h2 \"Settings\"]\n\n         (if @authed?\n           [:span (str \"Thank you for using and backing us, \" @email \" \u2764\ufe0f\")]\n           [:span \"You are using the free version of Athens. You are hosting your own data. Please be careful!\"])\n\n         [:div {:style {:margin \"10px 0\"}}\n          [:h5 \"Email\"]\n          [:div {:style {:margin \"5px 0\" :display \"flex\" :justify-content \"space-between\"}}\n           [:input {:style {:width \"15em\"} :type \"email\" :value @email :placeholder \"Open Collective Email\"\n                    :on-change #(handle-change-email email (.. % -target -value))}]\n           [button {:on-click #(handle-click-email @email authed? sending-request)\n                    :disabled submit-disabled\n                    :primary  true} \"Submit\"]]]\n\n         ;; Analytics\n\n         (if @opted-out?\n           [:h5 \"Opted Out of Analytics\"]\n           [:h5 \"Opted Into Analytics\"])\n         [:div {:style {:margin \"10px 0\"}}\n          [button {:primary  (false? @opted-out?)\n                   :disabled (not @authed?)\n                   :on-click #(handle-click opted-out?)}\n           (if @opted-out?\n             [:div {:style {:display \"flex\"}}\n              [:> mui-icons/ToggleOn]\n              [:span \"\\uD83D\\uDE41 We understand.\"]]\n             [:div {:style {:display \"flex\"}}\n              [:> mui-icons/ToggleOff]\n              [:span \"\\uD83D\\uDE00 Thanks for helping make Athens better!\"]])]]\n\n         [:span \"Analytics are delivered by \"\n          [:a {:href \"https://posthog.com\" :target \"_blank\"} \"Posthog\"]\n          \" and \" [:a {:href \"https://sentry.io\" :target \"_blank\"} \"Sentry\"]\n          \".\" (when (false? @authed?)\n                [:span\n                 \" In order to opt-out of analytics, please become a User or Sponsor through \"\n                 [:a {:href \"https://opencollective.com/athens\" :target \"_blank\"}\n                  \"OpenCollective.\"]])]\n\n         [:div {:style {:margin-top \"15px\"}}\n          [:h5 \"Remote Backups\"]\n          [:div {:style {:margin \"5px 0\" :display \"flex\" :justify-content \"space-between\"}}\n           [button {:disabled true}\n            \"Backup my DB to the cloud\"]\n           [:span \"Coming soon to \" [:a {:href \"https://opencollective.com/athens\" :target \"_blank\"}\n                                     \"paid Users and Sponsors\"]]]]\n\n         ;; Auto-save\n         [:div {:style {:margin \"20px 0\"}}\n          [:h5 \"Auto-save\"]\n          [:div {:style {:display \"flex\" :justify-content \"space-between\"\n                         :margin \"10px 0\"}}\n           [:input {:style {:width \"4em\"}\n                    :type  \"number\" :value @debounce-save-time! :on-change #(handle-debounce-save-input (js/Number (.. % -target -value)) debounce-save-time!)}]\n           (case @debounce-save-time!\n             0 [:span (str \"Athens will save and create a local backup after each edit.\")]\n             1 [:span (str \"Athens will save and create a local backup \" @debounce-save-time! \" second after your last edit.\")]\n             [:span (str \"Athens will save and create a local backup \" @debounce-save-time! \" seconds after your last edit.\")])]]]))))\n\n"]}